process {
    withName: NANOPLOT {
        publishDir = [
            path: { "${params.outdir}/NanoPlot/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: NANOPLOT_BULK {
        publishDir = [
            path: { "${params.outdir}/NanoPlot_bulk/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: NANOPLOT_SINGLE {
        publishDir = [
            path: { "${params.outdir}/NanoPlot_single/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: CUTADAPT_REORIENT_READS {
        publishDir = [
            path: { "${params.outdir}/cutadapt/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: FILTLONG {
        publishDir = [
            path: { "${params.outdir}/filtlong/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--verbose --min_length 500 --min_mean_q 99 --length_weight 0"
        ext.prefix = "quality-filtered"
    }

    withName: PORECHOP_PORECHOP {
        publishDir = [
            path: { "${params.outdir}/porechop/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "chopped"
    }

    withName: VSEARCH_DEREPLICATE {
        publishDir = [
            path: { "${params.outdir}/vsearch-derep/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: ITSXPRESS {
        publishDir = [
            path: { "${params.outdir}/itsxpress/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--region ALL --single_end --taxa Fungi"
        ext.prefix = "FULL_ITS"
    }

    withName: ITSX {
        publishDir = [
            path: { "${params.outdir}/itsx/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "ITS1"
    }

    withName: VSEARCH_CLUSTER_A {
        publishDir = [
            path: { "${params.outdir}/vsearch/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--id 0.98 --log vsearch.log --relabel OTU_ --fasta_width 0 --strand plus --sizein --qmask none --clusterout_sort"
        //--relabel_keep 
        ext.args2 = "--cluster_size"
        ext.args3 = "--centroids --otutabout --biomout --consout --uc"
    }

    withName: VSEARCH_MAP_READS_TO_OTUS {
        publishDir = [
            path: { "${params.outdir}/vsearch-otu-map/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: VSEARCH_SINTAX {
        publishDir = [
            path: { "${params.outdir}/vsearch-sintax/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: PHYLOSEQ {
        publishDir = [
            path: { "${params.outdir}/phyloseq/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: VSEARCH_UCHIME_DENOVO {
        publishDir = [
            path: { "${params.outdir}/vsearch-uchime-denovo/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "denovo"
    }

    withName: VSEARCH_UCHIME_REF {
        publishDir = [
            path: { "${params.outdir}/vsearch-uchime-ref/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "ref-unite"
    }

    withName: SEQKIT_REMOVE_CHIMERAS {
        publishDir = [
            path: { "${params.outdir}/seqkit-remove-chimeras/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }
}