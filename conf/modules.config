process {
    withName: NANOPLOT {
        publishDir = [
            path: { "${params.outdir}/localtest/NanoPlot/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: NANOPLOT_BULK {
        publishDir = [
            path: { "${params.outdir}/localtest/NanoPlot_bulk/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: NANOPLOT_SINGLE {
        publishDir = [
            path: { "${params.outdir}/localtest/NanoPlot_single/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: CUTADAPT_REORIENT_READS {
        publishDir = [
            path: { "${params.outdir}/localtest/cutadapt/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: FILTLONG {
        publishDir = [
            path: { "${params.outdir}/localtest/filtlong/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--verbose --min_length 500 --min_mean_q 99 --length_weight 0"
        ext.prefix = "quality-filtered"
    }

    withName: PORECHOP_PORECHOP {
        publishDir = [
            path: { "${params.outdir}/localtest/porechop/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "chopped"
    }

    withName: VSEARCH_DEREPLICATE {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch-derep/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }
    
    // withName: VSEARCH_RELABEL {
    //     publishDir = [
    //         path: { "${params.outdir}/localtest/vsearch-relabel/its1/${meta.id}" },
    //         mode: 'copy',
    //         enabled: false
    //     ]
    // }

    withName: ITSXPRESS {
        publishDir = [
            path: { "${params.outdir}/localtest/itsxpress/its1/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--region ALL --single_end --taxa Fungi"
        ext.prefix = "FULL_ITS"
    }

    withName: ITSX {
        publishDir = [
            path: { "${params.outdir}/localtest/itsx/its1/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "ITS1"
    }

    // withName: VSEARCH_CLUSTER {
    //     publishDir = [
    //         path: { "${params.outdir}/localtest/vsearch/its1/${meta.id}" },
    //         mode: 'copy',
    //         enabled: true
    //     ]
    //     ext.args = "--id 0.98 --log vsearch.log --consout consout --otutabout otu.tsv --biomout otus.biom"
    //     ext.args2 = "--cluster_size"
    //     ext.args3 = "--centroids"
    // }

    withName: VSEARCH_CLUSTER_A {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.args = "--id 0.98 --log vsearch.log --relabel OTU_ --fasta_width 0 --strand plus --sizein --qmask none --clusterout_sort"
        //--relabel_keep 
        ext.args2 = "--cluster_size"
        ext.args3 = "--centroids --otutabout --biomout --consout --uc"
    }

    withName: VSEARCH_MAP_READS_TO_OTUS {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch-otu-map/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: VSEARCH_SINTAX {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch-sintax/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: PHYLOSEQ {
        publishDir = [
            path: { "${params.outdir}/localtest/phyloseq/its1/" },
            mode: 'copy',
            enabled: true
        ]
    }

    withName: VSEARCH_UCHIME_DENOVO {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch-uchime-denovo/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "denovo"
    }

    withName: VSEARCH_UCHIME_REF {
        publishDir = [
            path: { "${params.outdir}/localtest/vsearch-uchime-ref/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
        ext.prefix = "ref-unite"
    }

    withName: SEQKIT_REMOVE_CHIMERAS {
        publishDir = [
            path: { "${params.outdir}/localtest/seqkit-remove-chimeras/${meta.id}" },
            mode: 'copy',
            enabled: true
        ]
    }
}